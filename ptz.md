1. üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –ü–û
–î–ª—è –∑–∞–ø—É—Å–∫–∞ –∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã –≤–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è:

Visual Studio (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤–µ—Ä—Å–∏—è 2022 –∏–ª–∏ –≤—ã—à–µ)
–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è: https://visualstudio.microsoft.com/ru/
–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ .NET (–≤–µ—Ä—Å–∏—è 5.0 –∏–ª–∏ –≤—ã—à–µ)
–°–∫–∞—á–∞—Ç—å –º–æ–∂–Ω–æ –∑–¥–µ—Å—å: https://dotnet.microsoft.com/download
2. üìÇ –û—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
–°–∫–∞—á–∞–π—Ç–µ –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —É–∂–µ –∏–º–µ—é—â–∏–π—Å—è –ø—Ä–æ–µ–∫—Ç –≤ Visual Studio.
–í –º–µ–Ω—é File ‚Üí Open ‚Üí Project/Solution , –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª CameraApp.csproj –∏–ª–∏ –ø–∞–ø–∫—É —Å –ø—Ä–æ–µ–∫—Ç–æ–º.
3. üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫ —á–µ—Ä–µ–∑ NuGet
–í –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –≤–Ω–µ—à–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–µ—Ä–µ–∑ NuGet Package Manager :

3.1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ OpenCvSharp4
–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Tools ‚Üí NuGet Package Manager ‚Üí Manage NuGet Packages for Solution
–ù–∞–π–¥–∏—Ç–µ OpenCvSharp4 –∏ OpenCvSharp4.runtime.win
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏—Ö –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.
3.2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ NAudio
–í —Ç–æ–º –∂–µ –æ–∫–Ω–µ NuGet –Ω–∞–π–¥–∏—Ç–µ NAudio
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç–∞–±–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.
‚ö†Ô∏è –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–µ—Ä—Å–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –≤–µ—Ä—Å–∏–µ–π .NET. 

4. üõ† –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
4.1. –¶–µ–ª–µ–≤–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
–í –æ–±–æ–∑—Ä–µ–≤–∞—Ç–µ–ª–µ —Ä–µ—à–µ–Ω–∏–π —â—ë–ª–∫–Ω–∏—Ç–µ –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –º—ã—à–∏ –Ω–∞ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ ‚Üí Properties
–í —Ä–∞–∑–¥–µ–ª–µ Application —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Target framework : .NET 5.0 –∏–ª–∏ .NET 6.0.
4.2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Å–±–æ—Ä–∫–∏:

System.Drawing.Common
System.Windows.Forms
OpenCvSharp
NAudio
–ï—Å–ª–∏ –æ–Ω–∏ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Äî –¥–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤—Ä—É—á–Ω—É—é:

–í –æ–±–æ–∑—Ä–µ–≤–∞—Ç–µ–ª–µ —Ä–µ—à–µ–Ω–∏–π ‚Üí Dependencies ‚Üí Add Reference
–í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–µ DLL –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ —á–µ—Ä–µ–∑ NuGet, –∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ –≤—ã—à–µ.
5. üéÆ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã
5.1. –ö–æ–º–ø–∏–ª—è—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫
–ù–∞–∂–º–∏—Ç–µ Build ‚Üí Build Solution , —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç —Å–æ–±—Ä–∞–Ω –±–µ–∑ –æ—à–∏–±–æ–∫.
–ù–∞–∂–º–∏—Ç–µ Start (–∏–ª–∏ F5), —á—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è PTZ-–∫–∞–º–µ—Ä–æ–π:
Form1.cs:

using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Drawing;
using System.IO;
using System.Linq;
using System.Windows.Forms;
using OpenCvSharp;
using OpenCvSharp.Extensions;
using NAudio.Wave;

namespace CameraApp
{
    public partial class Form1 : Form
    {
        private VideoCapture capture;
        private bool isRecording = false;
        private VideoWriter videoWriter;
        private WaveInEvent waveIn;
        private WaveFileWriter waveFileWriter;
        private string finalVideoFilePath;
        private string finalAudioFilePath;
        private int speedMultiplier = 1;
        private double zoomFactor = 1.0;
        private bool recordAudio = false;
        private Timer recordingIndicatorTimer;
        private bool recordingIndicatorVisible = false;

        public Form1()
        {
            InitializeComponent();
            FindAvailableCameras();
            PopulateMicrophones();
            this.Resize += Form1_Resize;
            videoPictureBox.MinimumSize = new System.Drawing.Size(1, 1);
            SetupRecordingIndicator();
        }

        private void SetupRecordingIndicator()
        {
            recordingIndicatorTimer = new Timer
            {
                Interval = 500
            };
            recordingIndicatorTimer.Tick += (s, e) =>
            {
                recordingIndicatorVisible = !recordingIndicatorVisible;
                videoPictureBox.Invalidate();
            };
        }

        private void FindAvailableCameras()
        {
            for (int i = 0; i < 10; i++)
            {
                using (var cap = new VideoCapture(i))
                {
                    if (cap.IsOpened())
                    {
                        cameraComboBox.Items.Add($"–ö–∞–º–µ—Ä–∞ {i}");
                        cap.Release();
                    }
                }
            }
            if (cameraComboBox.Items.Count > 0)
                cameraComboBox.SelectedIndex = 0;
            else
                MessageBox.Show("–ö–∞–º–µ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.", "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ", MessageBoxButtons.OK, MessageBoxIcon.Warning);
        }

        private void PopulateMicrophones()
        {
            microphoneComboBox.Items.Clear();
            int deviceCount = WaveIn.DeviceCount;
            if (deviceCount == 0)
            {
                MessageBox.Show("–ú–∏–∫—Ä–æ—Ñ–æ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ó–∞–ø–∏—Å—å –∑–≤—É–∫–∞ –±—É–¥–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω–∞.", "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                recordAudioCheckBox.Enabled = false;
                return;
            }

            for (int i = 0; i < deviceCount; i++)
            {
                var capabilities = WaveIn.GetCapabilities(i);
                microphoneComboBox.Items.Add(capabilities.ProductName);
            }
            if (microphoneComboBox.Items.Count > 0)
                microphoneComboBox.SelectedIndex = 0;
        }

        private void StartCamera()
        {
            if (cameraComboBox.SelectedIndex == -1)
            {
                MessageBox.Show("–ö–∞–º–µ—Ä–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞.", "–û—à–∏–±–∫–∞", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }
            int selectedCamera = cameraComboBox.SelectedIndex;
            capture = new VideoCapture(selectedCamera);
            if (!capture.IsOpened())
            {
                MessageBox.Show("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –∫–∞–º–µ—Ä—É.", "–û—à–∏–±–∫–∞", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }
            using (var testFrame = capture.RetrieveMat())
            {
                if (testFrame.Empty())
                {
                    MessageBox.Show("–ö–∞–º–µ—Ä–∞ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.", "–û—à–∏–±–∫–∞", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    capture.Release();
                    return;
                }
            }
            Application.Idle += UpdateVideo;
        }

        private void UpdateVideo(object sender, EventArgs e)
        {
            using (var frame = capture.RetrieveMat())
            {
                if (frame.Empty() || frame.Width <= 0 || frame.Height <= 0)
                {
                    return;
                }
                if (isRecording && videoWriter != null)
                {
                    if (frame.Width == videoWriter.FrameSize.Width && frame.Height == videoWriter.FrameSize.Height)
                    {
                        videoWriter.Write(frame);
                    }
                    else
                    {
                        MessageBox.Show("–†–∞–∑–º–µ—Ä—ã –∫–∞–¥—Ä–∞ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∑–∞–ø–∏—Å–∏.", "–û—à–∏–±–∫–∞", MessageBoxButtons.OK, MessageBoxIcon.Error);
                        isRecording = false;
                        recordButton.Text = "–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å";
                        videoWriter?.Release();
                        videoWriter = null;
                    }
                }
                var zoomedFrame = ApplyZoom(frame);
                using (var resizedFrame = ResizeFrameToFit(zoomedFrame, new System.Drawing.Size(videoPictureBox.Width, videoPictureBox.Height)))
                using (var bitmap = BitmapConverter.ToBitmap(resizedFrame))
                {
                    videoPictureBox.Image?.Dispose();
                    videoPictureBox.Image = new Bitmap(bitmap);
                }
            }
        }

        private bool SupportsHardwareZoom()
        {
            if (capture == null || !capture.IsOpened())
                return false;
            double zoomValue = capture.Get(VideoCaptureProperties.Zoom);
            return !double.IsNaN(zoomValue) && zoomValue >= 0;
        }

        private void ApplyHardwareZoom(double zoom)
        {
            if (capture != null && capture.IsOpened())
            {
                capture.Set(VideoCaptureProperties.Zoom, zoom);
            }
        }

        private Mat ApplyZoom(Mat frame)
        {
            if (Math.Abs(zoomFactor - 1.0) < 0.01 || SupportsHardwareZoom())
            {
                return frame;
            }
            var zoomedFrame = new Mat();
            Cv2.Resize(frame, zoomedFrame, new OpenCvSharp.Size((int)(frame.Width * zoomFactor), (int)(frame.Height * zoomFactor)));
            return zoomedFrame;
        }

        private Mat ResizeFrameToFit(Mat frame, System.Drawing.Size pictureBoxSize)
        {
            if (pictureBoxSize.Width <= 0 || pictureBoxSize.Height <= 0)
            {
                return frame;
            }
            var openCvSize = new OpenCvSharp.Size(pictureBoxSize.Width, pictureBoxSize.Height);
            double ratio = Math.Min(openCvSize.Width / frame.Width, openCvSize.Height / frame.Height);
            if (ratio <= 0)
            {
                return frame;
            }
            int newWidth = (int)(frame.Width * ratio);
            int newHeight = (int)(frame.Height * ratio);
            var resizedFrame = new Mat();
            Cv2.Resize(frame, resizedFrame, new OpenCvSharp.Size(newWidth, newHeight));
            return resizedFrame;
        }

        private void ToggleRecording()
        {
            if (capture == null || !capture.IsOpened())
            {
                MessageBox.Show("–ö–∞–º–µ—Ä–∞ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞.", "–û—à–∏–±–∫–∞", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            if (!isRecording)
            {
                // Video file selection
                var videoSaveFileDialog = new SaveFileDialog
                {
                    Title = "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–∏–¥–µ–æ –∫–∞–∫"
                };

                string selectedFormat = formatComboBox.SelectedItem.ToString();
                switch (selectedFormat)
                {
                    case "MP4":
                        videoSaveFileDialog.Filter = "MP4 Files (*.mp4)|*.mp4";
                        videoSaveFileDialog.DefaultExt = ".mp4";
                        break;
                    case "AVI":
                        videoSaveFileDialog.Filter = "AVI Files (*.avi)|*.avi";
                        videoSaveFileDialog.DefaultExt = ".avi";
                        break;
                    case "MKV":
                        videoSaveFileDialog.Filter = "MKV Files (*.mkv)|*.mkv";
                        videoSaveFileDialog.DefaultExt = ".mkv";
                        break;
                    default:
                        MessageBox.Show("–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç.", "–û—à–∏–±–∫–∞", MessageBoxButtons.OK, MessageBoxIcon.Error);
                        return;
                }

                if (videoSaveFileDialog.ShowDialog() != DialogResult.OK)
                    return;

                finalVideoFilePath = videoSaveFileDialog.FileName;

                // Audio file selection (if enabled)
                finalAudioFilePath = null;
                recordAudio = recordAudioCheckBox.Checked && recordAudioCheckBox.Enabled;
                if (recordAudio)
                {
                    var audioSaveFileDialog = new SaveFileDialog
                    {
                        Title = "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞—É–¥–∏–æ –∫–∞–∫",
                        Filter = "WAV Files (*.wav)|*.wav",
                        DefaultExt = ".wav",
                        FileName = Path.GetFileNameWithoutExtension(finalVideoFilePath) + "_audio"
                    };
                    if (audioSaveFileDialog.ShowDialog() != DialogResult.OK)
                    {
                        recordAudio = false;
                        recordAudioCheckBox.Checked = false;
                    }
                    else
                    {
                        finalAudioFilePath = audioSaveFileDialog.FileName;
                    }
                }

                int width = GetValidValue((int)capture.Get(VideoCaptureProperties.FrameWidth), 640);
                int height = GetValidValue((int)capture.Get(VideoCaptureProperties.FrameHeight), 480);
                double fps = GetValidValue(capture.Get(VideoCaptureProperties.Fps), 30);

                if (width <= 0 || height <= 0 || fps <= 0)
                {
                    MessageBox.Show("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞.", "–û—à–∏–±–∫–∞", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    return;
                }

                FourCC fourcc;
                switch (selectedFormat)
                {
                    case "MP4":
                        fourcc = FourCC.MP4V;
                        break;
                    case "AVI":
                        fourcc = FourCC.XVID;
                        break;
                    case "MKV":
                        MessageBox.Show("MKV –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∫–æ–¥–µ–∫–∏. –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω MJPG.", "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                        fourcc = FourCC.MJPG;
                        break;
                    default:
                        MessageBox.Show("–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç.", "–û—à–∏–±–∫–∞", MessageBoxButtons.OK, MessageBoxIcon.Error);
                        return;
                }

                videoWriter = new VideoWriter(finalVideoFilePath, fourcc, fps, new OpenCvSharp.Size(width, height));
                if (!videoWriter.IsOpened())
                {
                    MessageBox.Show("–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å.", "–û—à–∏–±–∫–∞", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    return;
                }

                if (recordAudio)
                {
                    StartAudioRecording();
                }

                isRecording = true;
                recordButton.Text = "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å";
                recordingIndicatorTimer.Start();
            }
            else
            {
                isRecording = false;
                recordButton.Text = "–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å";
                recordingIndicatorTimer.Stop();
                recordingIndicatorVisible = false;
                videoPictureBox.Invalidate();

                videoWriter?.Release();
                videoWriter = null;

                if (recordAudio)
                {
                    StopAudioRecording();
                }

                if (recordAudio && finalAudioFilePath != null)
                {
                    MessageBox.Show($"–í–∏–¥–µ–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤: {finalVideoFilePath}\n–ê—É–¥–∏–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤: {finalAudioFilePath}", "–ó–∞–ø–∏—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞", MessageBoxButtons.OK, MessageBoxIcon.Information);
                }
                else
                {
                    MessageBox.Show($"–í–∏–¥–µ–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤: {finalVideoFilePath}", "–ó–∞–ø–∏—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞", MessageBoxButtons.OK, MessageBoxIcon.Information);
                }
            }
        }

        private void StartAudioRecording()
        {
            try
            {
                if (microphoneComboBox.SelectedIndex == -1)
                {
                    MessageBox.Show("–ú–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–µ –≤—ã–±—Ä–∞–Ω.", "–û—à–∏–±–∫–∞", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    recordAudio = false;
                    recordAudioCheckBox.Checked = false;
                    return;
                }

                if (File.Exists(finalAudioFilePath))
                    File.Delete(finalAudioFilePath);

                waveIn = new WaveInEvent
                {
                    DeviceNumber = microphoneComboBox.SelectedIndex,
                    WaveFormat = new WaveFormat(44100, 16, 1)
                };
                waveFileWriter = new WaveFileWriter(finalAudioFilePath, waveIn.WaveFormat);
                waveIn.DataAvailable += OnAudioDataAvailable;
                waveIn.RecordingStopped += (s, e) =>
                {
                    waveIn?.Dispose();
                    waveIn = null;
                    waveFileWriter?.Dispose();
                    waveFileWriter = null;
                };
                waveIn.StartRecording();
            }
            catch (Exception ex)
            {
                MessageBox.Show($"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∑–∞–ø–∏—Å–∏ –∑–≤—É–∫–∞: {ex.Message}", "–û—à–∏–±–∫–∞", MessageBoxButtons.OK, MessageBoxIcon.Error);
                recordAudio = false;
                recordAudioCheckBox.Checked = false;
                waveIn?.Dispose();
                waveFileWriter?.Dispose();
            }
        }

        private void StopAudioRecording()
        {
            waveIn?.StopRecording();
            waveIn?.Dispose();
            waveIn = null;
            waveFileWriter?.Dispose();
            waveFileWriter = null;
        }

        private void OnAudioDataAvailable(object sender, WaveInEventArgs e)
        {
            if (waveFileWriter != null)
            {
                waveFileWriter.Write(e.Buffer, 0, e.BytesRecorded);
                waveFileWriter.Flush();
            }
        }

        private int GetValidValue(int value, int defaultValue)
        {
            return value > 0 ? value : defaultValue;
        }

        private double GetValidValue(double value, double defaultValue)
        {
            return value > 0 ? value : defaultValue;
        }

        private void AdjustSpeed(object sender, EventArgs e)
        {
            speedMultiplier = speedTrackBar.Value;
            speedLabel.Text = $"–°–∫–æ—Ä–æ—Å—Ç—å: {speedMultiplier}";
        }

        private void ZoomIn()
        {
            zoomFactor += 0.1;
            if (SupportsHardwareZoom())
            {
                ApplyHardwareZoom(zoomFactor * 100);
            }
        }

        private void ZoomOut()
        {
            zoomFactor = Math.Max(zoomFactor - 0.1, 0.1);
            if (SupportsHardwareZoom())
            {
                ApplyHardwareZoom(zoomFactor * 100);
            }
        }

        private void PanLeft()
        {
            if (capture != null)
            {
                double currentPan = capture.Get(VideoCaptureProperties.Pan);
                capture.Set(VideoCaptureProperties.Pan, currentPan - speedMultiplier);
            }
        }

        private void PanRight()
        {
            if (capture != null)
            {
                double currentPan = capture.Get(VideoCaptureProperties.Pan);
                capture.Set(VideoCaptureProperties.Pan, currentPan + speedMultiplier);
            }
        }

        private void TiltUp()
        {
            if (capture != null)
            {
                double currentTilt = capture.Get(VideoCaptureProperties.Tilt);
                capture.Set(VideoCaptureProperties.Tilt, currentTilt + speedMultiplier);
            }
        }

        private void TiltDown()
        {
            if (capture != null)
            {
                double currentTilt = capture.Get(VideoCaptureProperties.Tilt);
                capture.Set(VideoCaptureProperties.Tilt, currentTilt - speedMultiplier);
            }
        }

        private void Form1_FormClosing(object sender, FormClosingEventArgs e)
        {
            if (capture != null && capture.IsOpened())
                capture.Release();
            if (waveIn != null)
                waveIn.Dispose();
            if (waveFileWriter != null)
                waveFileWriter.Dispose();
            if (videoWriter != null)
                videoWriter.Release();
            recordingIndicatorTimer?.Dispose();
        }

        private void Form1_Resize(object sender, EventArgs e)
        {
            if (videoPictureBox != null)
            {
                videoPictureBox.Invalidate();
            }
        }

        private void VideoPictureBox_Paint(object sender, PaintEventArgs e)
        {
            if (isRecording && recordingIndicatorVisible)
            {
                using (var brush = new SolidBrush(Color.Red))
                {
                    e.Graphics.FillEllipse(brush, 10, 10, 20, 20);
                }
                using (var font = new Font("Arial", 12))
                using (var brush = new SolidBrush(Color.Red))
                {
                    e.Graphics.DrawString("Recording", font, brush, 35, 10);
                }
            }
        }
    }
}

Form1.designer.cs:

using System.Drawing;
using System.Windows.Forms;

namespace CameraApp
{
    partial class Form1
    {
        private System.ComponentModel.IContainer components = null;
        private PictureBox videoPictureBox;
        private ComboBox cameraComboBox;
        private Button startButton;
        private Button recordButton;
        private TrackBar speedTrackBar;
        private Label speedLabel;
        private Button zoomInButton;
        private Button zoomOutButton;
        private Button panLeftButton;
        private Button panRightButton;
        private Button tiltUpButton;
        private Button tiltDownButton;
        private ComboBox formatComboBox;
        private ComboBox microphoneComboBox;
        private CheckBox recordAudioCheckBox;
        private Button toggleFullScreenButton;

        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null))
            {
                components.Dispose();
            }
            base.Dispose(disposing);
        }

        private void InitializeComponent()
        {
            this.components = new System.ComponentModel.Container();
            this.videoPictureBox = new PictureBox();
            this.cameraComboBox = new ComboBox();
            this.startButton = new Button();
            this.recordButton = new Button();
            this.speedTrackBar = new TrackBar();
            this.speedLabel = new Label();
            this.zoomInButton = new Button();
            this.zoomOutButton = new Button();
            this.panLeftButton = new Button();
            this.panRightButton = new Button();
            this.tiltUpButton = new Button();
            this.tiltDownButton = new Button();
            this.formatComboBox = new ComboBox();
            this.microphoneComboBox = new ComboBox();
            this.recordAudioCheckBox = new CheckBox();
            this.toggleFullScreenButton = new Button();

            // videoPictureBox
            this.videoPictureBox.Dock = DockStyle.Fill;
            this.videoPictureBox.BackColor = Color.Black;
            this.videoPictureBox.SizeMode = PictureBoxSizeMode.Zoom;
            this.videoPictureBox.Paint += VideoPictureBox_Paint;

            // cameraComboBox
            this.cameraComboBox.Dock = DockStyle.Top;
            this.cameraComboBox.DropDownStyle = ComboBoxStyle.DropDownList;
            this.cameraComboBox.Width = 300;
            this.cameraComboBox.Height = 30;
            this.cameraComboBox.Font = new Font("Arial", 10);
            this.cameraComboBox.Margin = new Padding(0, 5, 0, 10);

            // startButton
            this.startButton.Dock = DockStyle.Top;
            this.startButton.Text = "–ó–∞–ø—É—Å—Ç–∏—Ç—å";
            this.startButton.FlatStyle = FlatStyle.Flat;
            this.startButton.BackColor = Color.FromArgb(0, 120, 215);
            this.startButton.ForeColor = Color.White;
            this.startButton.Width = 300;
            this.startButton.Height = 40;
            this.startButton.Font = new Font("Arial", 10);
            this.startButton.Click += (s, e) => StartCamera();

            // recordButton
            this.recordButton.Dock = DockStyle.Top;
            this.recordButton.Text = "–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å";
            this.recordButton.FlatStyle = FlatStyle.Flat;
            this.recordButton.BackColor = Color.FromArgb(220, 53, 69);
            this.recordButton.ForeColor = Color.White;
            this.recordButton.Width = 300;
            this.recordButton.Height = 40;
            this.recordButton.Font = new Font("Arial", 10);
            this.recordButton.Click += (s, e) => ToggleRecording();

            // speedTrackBar
            this.speedTrackBar.Dock = DockStyle.Top;
            this.speedTrackBar.Minimum = 1;
            this.speedTrackBar.Maximum = 10;
            this.speedTrackBar.Value = 1;
            this.speedTrackBar.TickFrequency = 1;
            this.speedTrackBar.Width = 300;
            this.speedTrackBar.Height = 30;
            this.speedTrackBar.Margin = new Padding(0, 5, 0, 10);
            this.speedTrackBar.Scroll += AdjustSpeed;

            // speedLabel
            this.speedLabel.Dock = DockStyle.Top;
            this.speedLabel.Text = "–°–∫–æ—Ä–æ—Å—Ç—å: 1";
            this.speedLabel.Font = new Font("Arial", 10);
            this.speedLabel.AutoSize = true;
            this.speedLabel.Margin = new Padding(0, 5, 0, 10);

            // zoomInButton
            this.zoomInButton.Dock = DockStyle.Top;
            this.zoomInButton.Text = "–ó—É–º +";
            this.zoomInButton.FlatStyle = FlatStyle.Flat;
            this.zoomInButton.Width = 300;
            this.zoomInButton.Height = 40;
            this.zoomInButton.Font = new Font("Arial", 10);
            this.zoomInButton.Click += (s, e) => ZoomIn();

            // zoomOutButton
            this.zoomOutButton.Dock = DockStyle.Top;
            this.zoomOutButton.Text = "–ó—É–º -";
            this.zoomOutButton.FlatStyle = FlatStyle.Flat;
            this.zoomOutButton.Width = 300;
            this.zoomOutButton.Height = 40;
            this.zoomOutButton.Font = new Font("Arial", 10);
            this.zoomOutButton.Click += (s, e) => ZoomOut();

            // panLeftButton
            this.panLeftButton.Dock = DockStyle.Top;
            this.panLeftButton.Text = "‚óÑ";
            this.panLeftButton.FlatStyle = FlatStyle.Flat;
            this.panLeftButton.Width = 300;
            this.panLeftButton.Height = 40;
            this.panLeftButton.Font = new Font("Arial", 10);
            this.panLeftButton.Click += (s, e) => PanLeft();

            // panRightButton
            this.panRightButton.Dock = DockStyle.Top;
            this.panRightButton.Text = "‚ñ∫";
            this.panRightButton.FlatStyle = FlatStyle.Flat;
            this.panRightButton.Width = 300;
            this.panRightButton.Height = 40;
            this.panRightButton.Font = new Font("Arial", 10);
            this.panRightButton.Click += (s, e) => PanRight();

            // tiltUpButton
            this.tiltUpButton.Dock = DockStyle.Top;
            this.tiltUpButton.Text = "‚ñ≤";
            this.tiltUpButton.FlatStyle = FlatStyle.Flat;
            this.tiltUpButton.Width = 300;
            this.tiltUpButton.Height = 40;
            this.tiltUpButton.Font = new Font("Arial", 10);
            this.tiltUpButton.Click += (s, e) => TiltUp();

            // tiltDownButton
            this.tiltDownButton.Dock = DockStyle.Top;
            this.tiltDownButton.Text = "‚ñº";
            this.tiltDownButton.FlatStyle = FlatStyle.Flat;
            this.tiltDownButton.Width = 300;
            this.tiltDownButton.Height = 40;
            this.tiltDownButton.Font = new Font("Arial", 10);
            this.tiltDownButton.Click += (s, e) => TiltDown();

            // formatComboBox
            this.formatComboBox.Dock = DockStyle.Top;
            this.formatComboBox.DropDownStyle = ComboBoxStyle.DropDownList;
            this.formatComboBox.Items.AddRange(new string[] { "MP4", "AVI", "MKV" });
            this.formatComboBox.SelectedIndex = 0;
            this.formatComboBox.Width = 300;
            this.formatComboBox.Height = 30;
            this.formatComboBox.Font = new Font("Arial", 10);
            this.formatComboBox.Margin = new Padding(0, 5, 0, 10);

            // microphoneComboBox
            this.microphoneComboBox.Dock = DockStyle.Top;
            this.microphoneComboBox.DropDownStyle = ComboBoxStyle.DropDownList;
            this.microphoneComboBox.Width = 300;
            this.microphoneComboBox.Height = 30;
            this.microphoneComboBox.Font = new Font("Arial", 10);
            this.microphoneComboBox.Margin = new Padding(0, 5, 0, 10);

            // recordAudioCheckBox
            this.recordAudioCheckBox.Dock = DockStyle.Top;
            this.recordAudioCheckBox.Text = "–ó–∞–ø–∏—Å—ã–≤–∞—Ç—å –∑–≤—É–∫";
            this.recordAudioCheckBox.Checked = false;
            this.recordAudioCheckBox.Font = new Font("Arial", 10);
            this.recordAudioCheckBox.AutoSize = true;
            this.recordAudioCheckBox.Margin = new Padding(0, 5, 0, 10);

            // toggleFullScreenButton
            this.toggleFullScreenButton.Dock = DockStyle.Top;
            this.toggleFullScreenButton.Text = "–û–∫–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º";
            this.toggleFullScreenButton.FlatStyle = FlatStyle.Flat;
            this.toggleFullScreenButton.BackColor = Color.FromArgb(108, 117, 125);
            this.toggleFullScreenButton.ForeColor = Color.White;
            this.toggleFullScreenButton.Width = 300;
            this.toggleFullScreenButton.Height = 40;
            this.toggleFullScreenButton.Font = new Font("Arial", 10);
            this.toggleFullScreenButton.Margin = new Padding(0, 15, 0, 15);
            this.toggleFullScreenButton.Click += (s, e) =>
            {
                this.WindowState = this.WindowState == FormWindowState.Maximized ? FormWindowState.Normal : FormWindowState.Maximized;
                this.toggleFullScreenButton.Text = this.WindowState == FormWindowState.Maximized ? "–û–∫–æ–Ω–Ω—ã–π —Ä–µ–∂–∏–º" : "–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º";
            };

            // MainForm
            this.Text = "–ö–∞–º–µ—Ä–∞: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –ù–∞—Å—Ç—Ä–æ–π–∫–∏";
            this.WindowState = FormWindowState.Maximized;
            this.MinimumSize = new System.Drawing.Size(640, 480);
            this.FormClosing += Form1_FormClosing;

            // Panels
            var mainPanel = new Panel { Dock = DockStyle.Fill };
            var controlPanel = new Panel { Dock = DockStyle.Right, Width = 350, BackColor = Color.FromArgb(240, 240, 240) };

            // Add videoPictureBox to mainPanel
            mainPanel.Controls.Add(videoPictureBox);

            // Add controls to controlPanel in order
            controlPanel.Controls.AddRange(new Control[]
            {
                cameraComboBox,
                startButton,
                recordButton,
                speedLabel,
                speedTrackBar,
                zoomInButton,
                zoomOutButton,
                panLeftButton,
                panRightButton,
                tiltUpButton,
                tiltDownButton,
                formatComboBox,
                microphoneComboBox,
                recordAudioCheckBox,
                toggleFullScreenButton
            });

            // Add panels to form
            this.Controls.Add(mainPanel);
            this.Controls.Add(controlPanel);
        }
    }
}